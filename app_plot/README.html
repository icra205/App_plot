<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>我的设计说明</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding-top: 8px; padding-bottom: 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }






</style>
</head>
<body class='typora-export os-windows' >
<div  id='write'  class = 'is-node'><h1><a name='header-n0' class='md-header-anchor '></a>解释器程序说明</h1><p>为帮助大家理解并掌握《编译原理》课程的词法分析、语法分析、语义分析等章节的相关知识，我特意实现了“函数绘图语言的解释器”这个程序。</p><p>因为同一需求可有多种不同实现，所以:</p><ul><li>你在刘坚老师编著的《编译原理基础-习题与上机题解答》（下文简称《习题解答》）中可以看到一个实现的代码，它相对简单简易。</li><li>你现在看到的是我编写的版本之一：用 C++ 语言、采用 面向对象 思想设计实现的。它相对更加强大也稍复杂。</li></ul><hr /><p>目  录</p><hr /><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h1" data-ref="n0"><a class="md-toc-inner" href="#header-n0">解释器程序说明</a></span><span class="md-toc-item md-toc-h1" data-ref="n14"><a class="md-toc-inner" href="#header-n14">1. 前言</a></span><span class="md-toc-item md-toc-h1" data-ref="n43"><a class="md-toc-inner" href="#header-n43">2. 模块划分&amp;组织</a></span><span class="md-toc-item md-toc-h2" data-ref="n44"><a class="md-toc-inner" href="#header-n44">2.1 模块划分与目录（文件夹）组织</a></span><span class="md-toc-item md-toc-h2" data-ref="n72"><a class="md-toc-inner" href="#header-n72">2.2 模块之间的组织关系</a></span><span class="md-toc-item md-toc-h2" data-ref="n114"><a class="md-toc-inner" href="#header-n114">2.3 可生成的可执行程序</a></span><span class="md-toc-item md-toc-h3" data-ref="n120"><a class="md-toc-inner" href="#header-n120">程序1——词法分析测试程序</a></span><span class="md-toc-item md-toc-h3" data-ref="n123"><a class="md-toc-inner" href="#header-n123">程序2——语法分析测试程序</a></span><span class="md-toc-item md-toc-h3" data-ref="n131"><a class="md-toc-inner" href="#header-n131">程序3——仅有一个GUI窗口的<em>解释器程序</em></a></span><span class="md-toc-item md-toc-h3" data-ref="n135"><a class="md-toc-inner" href="#header-n135">程序4——有控制台窗口的<em>解释器程序</em></a></span><span class="md-toc-item md-toc-h1" data-ref="n153"><a class="md-toc-inner" href="#header-n153">3. 词法分析器模块（目录 lexer）</a></span><span class="md-toc-item md-toc-h2" data-ref="n154"><a class="md-toc-inner" href="#header-n154">3.1 源文件</a></span><span class="md-toc-item md-toc-h3" data-ref="n178"><a class="md-toc-inner" href="#header-n178">生成词法测试程序</a></span><span class="md-toc-item md-toc-h2" data-ref="n191"><a class="md-toc-inner" href="#header-n191">3.2 记号的数据类型</a></span><span class="md-toc-item md-toc-h2" data-ref="n194"><a class="md-toc-inner" href="#header-n194">3.3 词法错误处理策略</a></span><span class="md-toc-item md-toc-h1" data-ref="n208"><a class="md-toc-inner" href="#header-n208">4. 语法分析器模块（目录 parser）</a></span><span class="md-toc-item md-toc-h2" data-ref="n209"><a class="md-toc-inner" href="#header-n209">4.1 源文件</a></span><span class="md-toc-item md-toc-h3" data-ref="n229"><a class="md-toc-inner" href="#header-n229">生成语法测试程序</a></span><span class="md-toc-item md-toc-h2" data-ref="n243"><a class="md-toc-inner" href="#header-n243">4.2 实现模式</a></span><span class="md-toc-item md-toc-h2" data-ref="n247"><a class="md-toc-inner" href="#header-n247">4.3 关于语法树</a></span><span class="md-toc-item md-toc-h2" data-ref="n284"><a class="md-toc-inner" href="#header-n284">4.4 语法错误处理策略</a></span><span class="md-toc-item md-toc-h1" data-ref="n293"><a class="md-toc-inner" href="#header-n293">5. 错误处理模块（目录 errlog）</a></span><span class="md-toc-item md-toc-h2" data-ref="n295"><a class="md-toc-inner" href="#header-n295">5.1 源文件</a></span><span class="md-toc-item md-toc-h2" data-ref="n302"><a class="md-toc-inner" href="#header-n302">5.2 重要提示</a></span><span class="md-toc-item md-toc-h1" data-ref="n306"><a class="md-toc-inner" href="#header-n306">6. 语义分析模块（目录 semantics）</a></span><span class="md-toc-item md-toc-h2" data-ref="n309"><a class="md-toc-inner" href="#header-n309">6.1 源文件</a></span><span class="md-toc-item md-toc-h2" data-ref="n318"><a class="md-toc-inner" href="#header-n318">6.2 错误处理策略</a></span><span class="md-toc-item md-toc-h1" data-ref="n323"><a class="md-toc-inner" href="#header-n323">7. 主控+人机界面模块（目录 ui_main）</a></span><span class="md-toc-item md-toc-h2" data-ref="n326"><a class="md-toc-inner" href="#header-n326">7.1 源程序</a></span><span class="md-toc-item md-toc-h2" data-ref="n362"><a class="md-toc-inner" href="#header-n362">7.2 编译/生成解释器</a></span><span class="md-toc-item md-toc-h2" data-ref="n381"><a class="md-toc-inner" href="#header-n381">7.3  执行解释器程序</a></span><span class="md-toc-item md-toc-h1" data-ref="n384"><a class="md-toc-inner" href="#header-n384">FINAL:我要说的其他话</a></span></p></div><h1><a name='header-n14' class='md-header-anchor '></a>1. 前言</h1><p>程序的核心代码参考自刘坚老师编著的《编译原理基础-习题与上机题解答》，但本实现对其做了优化、扩展、并转换为C++面向对象版，包括但不限于：</p><p>(1) 解释器中涉及的记号(Token)、词法分析器、语法分析器、语义分析器、语法树（结点）等都是“对象（Object）”，其类型分别定义为一个 类（class）。</p><p>(2) 记号对象中除了存储其种类外，还存储了其在输入中的位置、文本等等信息。</p><p>(3) 程序为全部的有效输入构造了一颗（庞大的）抽象语法树（AST，本文简称<strong>语法树</strong>），其根结点仅存放了被分析的文件名，每个语句对应一个二级节点，语句的孩子都是表达式的语法树。</p><p>(4) 语法树并没有对应的类，但本实现中按语法树结点的性质，对结点们进行分类，并定义为一族有继承关系的类。语法树的结点中存放了对应的记号对象（即终结符）。</p><p>(5) 解释执行过程中，发现语法错误、词法错误时，采用<strong>“紧急恢复”</strong>策略，使得分析、解释执行可以继续进行（当然解释执行的结果可能和期望的不一样）。</p><p>(6) 对函数绘图语言进行了以下扩展，你可以模仿它们进行其他扩展：</p><ul><li>增加了自定义函数 <code>_AYY_()</code>，对用户而言，它和 <code>sin()</code>、<code>cos()</code>等类同；</li><li>增加了命名常量 <code>XD</code> 和 <code>WXQ</code>，对用户而言，它和 <code>pi</code>, <code>e</code> 类同；</li><li>增加了设置绘图颜色的语句 <code>color is ( Red_expression, Green_expression, Blue_expression)</code>。其中 <code>color</code>、<code>is</code> 是关键字，而 Red_expression、Green_expression、Blue_expression 分别为产生某一颜色所需的红色、绿色、蓝色分量的表达式，它们的取值范围均是 [0~255]。</li><li>增加了设置绘图颜色的第二种语句 <code>color is ColorName</code>。其中 <code>color</code>、<code>is</code> 是关键字，而 ColorName 是解释器中预先定义好的若干颜色名字（是特殊的标识符）。</li></ul><p>(7) 将语义分析 和 语法分析明确地划分为两个阶段，所以并未采用“语法制导翻译”的思路进行语义分析！</p><ul><li><p>关键手段是语法分析为输入构造完整的语法树，语义分析则通过遍历语法树完成计算；</p></li><li><p>在《习题解答》给出的解释器源代码中，采用了“半语法制导翻译”的策略：</p><ul><li>对于四种语句的处理是语法制导翻译：语法分析时每当识别到一个句子立即进行语义分析；</li><li>对各种表达式则采用“非语法制导翻译”：语法分析仅构造语法树，对其求值（语义分析）则在各个语句的语义计算中执行。</li></ul></li></ul><h1><a name='header-n43' class='md-header-anchor '></a>2. 模块划分&amp;组织</h1><h2><a name='header-n44' class='md-header-anchor '></a>2.1 模块划分与目录（文件夹）组织</h2><p>  每个模块提供的对外接口声明文件（头文件），统一存放到目录 <code>include</code> 下；各模块的实现文件则存放到各自不同的目录下。</p><p>  源代码文件的目录组织结构 直观地 反映了模块划分：</p><figure><table><thead><tr><th style='text-align:center;' >目录名</th><th style='text-align:center;' >namespace名</th><th>中文模块名</th></tr></thead><tbody><tr><td style='text-align:center;' >lexer</td><td style='text-align:center;' >module_Lexer</td><td>词法分析器</td></tr><tr><td style='text-align:center;' >parser</td><td style='text-align:center;' >module_Parser</td><td>语法分析器</td></tr><tr><td style='text-align:center;' >semantics</td><td style='text-align:center;' >module_Semantic</td><td>语义分析器</td></tr><tr><td style='text-align:center;' >errlog</td><td style='text-align:center;' >module_ErrLog</td><td>错误报告</td></tr><tr><td style='text-align:center;' >ui_main</td><td style='text-align:center;' >module_UI</td><td>人机界面+程序主控</td></tr></tbody></table></figure><h2><a name='header-n72' class='md-header-anchor '></a>2.2 模块之间的组织关系</h2><p>  这里用一个简易图形示意各模块之间的主要 依赖关系，箭头指向的是被依赖者。</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 37.1614px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28.9974px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 语义分析模块  → 错误报告模块</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  │ &nbsp;  ↓ &nbsp; &nbsp; &nbsp; │</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  │ &nbsp; &nbsp; ￣￣￣￣│</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  ↓ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ↓</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 语法分析模块 → UI 模块</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  │</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  ↓</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; 词法分析模块(内含DFA子模块)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="height: 180px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><p>(0) 主程序模块依赖于其他所有模块（图中未给出）：</p><ul><li>包括 main()，解释器的类型定义+实现。</li><li>负责启动解释器、人机界面模块，进而驱动解释执行。</li></ul><p>(1) 词法分析器作为语法分析的子程序：</p><ul><li>将语法分析+词法分析的工作合并为一个工作阶段。</li><li>语法分析器对象关联一个特定的词法分析器对象，从而利用后者获取记号，也可访问后者的信息。</li><li>语法分析时，反复调用词法分析提供的关键接口操作 <code>Lexer::GetToken()</code> 获取下一个记号对象。</li></ul><p>(2) 语法分析、语义分析是两个相对独立、依次顺序执行的阶段：</p><ul><li>语法分析过程包含了词法分析；</li><li>语法分析的结果是为完整输入构造的语法树，而语义分析则对语法树边遍历边解释执行，从而它们一起构成解释器的核心。</li></ul><p>(3) 语义分析器关联一个特定的语法分析器对象：</p><ul><li>简单情况下，二者无需关联，只需主控部分将语法分析器所得语法树交给语义分析器即可，但是</li><li>因为我的实现中由语义分析器指定 T 值的存放位置，同时语义分析过程中需要语法分析器提供一些信息，如文件名等.</li></ul><p>(4) 为使得错误处理较为简单，程序便于理解，错误报告模块仅仅实现了错误信息的报告和记录。</p><ul><li>错误信息的报告方式基于 UI 模块的接口实现。</li><li>如何处理错误则由其他各模块自己负责。</li></ul><p>(5) 人机界面模块实现了人机界面的维护、信息的显示。</p><ul><li>该模块定义了基于控制台、Windows 系统窗口的多种人机界面。</li><li>各种信息的展示（如错误报告）、绘制一个像素点等均基于 UI 模块的接口实现。</li></ul><p>&nbsp;</p><h2><a name='header-n114' class='md-header-anchor '></a>2.3 可生成的可执行程序</h2><p>按照模块源代码的不同组合，我这个实现可生成四个可执行程序。各个程序执行时，必须用 <strong>命令行参数</strong> 来指定待分析的“函数绘图语言源程序文件之路径名”。</p><blockquote><p>程序3、4需要用到系统的 GUI 界面服务，对此我仅考虑了在 Microsoft Windows 中运行这些程序、且直接调用 Windows API 实现绘图操作和窗口管理。</p></blockquote><blockquote><p>程序1、2、4的主函数都是 <code>main()</code>，而程序3的主函数是<code>WinMain()</code>。</p></blockquote><h3><a name='header-n120' class='md-header-anchor '></a>程序1——词法分析测试程序</h3><p>该程序仅对词法分析器模块进行测试，需要编译/链接词法分析部分的源代码，且按照“<strong>控制台应用（Win32 Console Application Project）</strong>”来生成可执行程序。</p><p>该程序仅在标准输出设备上显示识别到的记号序列。对于错误的单词，均显示为种类为 <code>ERRTOKEN</code> 的条目。</p><h3><a name='header-n123' class='md-header-anchor '></a>程序2——语法分析测试程序</h3><p>该程序对语法分析器模块进行测试，但也用到了词法分析器模块。需要编译/链接词法分析、语法分析、错误报告、人机界面中一部分源代码（详见下文关于语法分析器模块的说明），且按照“<strong>控制台应用（Win32 Console Application Project）</strong>”来生成可执行程序。</p><p>该程序运行时，在屏幕上显示提示信息和错误信息，也在当前目录下生成两个文件：</p><ul><li>error.log: 记录错误信息，同时也显示到屏幕上。</li><li>parser.log: 该文件内容不输出到屏幕上。文件中记录了语法分析过程中所执行的递归下降子程序及其顺序，也记录了生成的抽象语法树。</li></ul><h3><a name='header-n131' class='md-header-anchor '></a>程序3——仅有一个GUI窗口的<em>解释器程序</em></h3><p>该程序需要几乎全部源代码，且按照“<strong>Win32应用（Win32 Application Project）</strong>”来编译。</p><p>该程序仅有一个窗口用于绘制图形，对于错误信息则采用弹出式窗口来显示。同时也会如同程序2 产生两个相同文件。</p><p>该程序运行时，如果命令行参数没有指定待分析的源文件，则会自动弹出文件选择窗口。</p><h3><a name='header-n135' class='md-header-anchor '></a>程序4——有控制台窗口的<em>解释器程序</em></h3><p>该程序需要几乎全部源代码，且按照“<strong>控制台应用（Win32 Console Application Project）</strong>”来编译，但编译时需指定要额外链接的函数库 <code>gdi32</code> 和 <code>comdlg32</code>。</p><p>该程序运行时，也会如同程序2 产生两个相同文件。这个程序运行的命令行参数规定为：
（假设编译生成的可执行文件名为 dl.exe）</p><ul><li>方式1：dl.exe 文件路径  界面类型选项</li></ul><p> 若&quot;界面类型选项&quot;没有指定，或者有且是 &quot;wincon&quot; 或者 &quot;conwin&quot; ，则显示两个窗口，其中一个是控制台窗口（用于显示提示、错误信息等），一个是普通的窗口（用于绘制图形）。</p><p>若&quot;界面类型选项&quot;是 &quot;con&quot;，仅存在一个控制台窗口，且不能绘制图形，但是将绘图操作转换为在标准输出设备(stdout, cout) 中显示提示信息。</p><p>若&quot;界面类型选项&quot;是 &quot;win&quot;，仅存在一个常规窗口，用于绘制图形。所有的信息显示均用弹出对话框的形式展示。</p><ul><li>方式2：dl.exe 界面类型选项</li></ul><p>此时会提示你输入/选择待分析的文件。若指定文件可读，则就读入它并解释执行。运行时的界面取决于&quot;界面类型选项&quot;的值（和方式1相同）。</p><ul><li>方式3：dl.exe 没有其他参数</li></ul><p>此时会弹出文件选择窗口，让你指定待分析的源文件。
若指定文件可读，则运行时的界面与方式1中用 &quot;wincon&quot; 时的两个窗口相同。</p><p>&nbsp;</p><h1><a name='header-n153' class='md-header-anchor '></a>3. 词法分析器模块（目录 lexer）</h1><h2><a name='header-n154' class='md-header-anchor '></a>3.1 源文件</h2><figure><table><thead><tr><th>文件</th><th>文件内容说明</th></tr></thead><tbody><tr><td>include/lexer.hpp</td><td>词法分析器的类型及其对外提供的服务接口声明</td></tr><tr><td>lexer/lexer.cpp</td><td>词法分析器的实现，内含一个小型符号表（其内容不可变）</td></tr><tr><td>lexer/dfa.hpp</td><td>定义了 DFA 对 词法分析器提供的服务类之基类、接口声明。该接口仅供 lexer.cpp 内部使用</td></tr><tr><td>lexer/dfa_hardCode.cpp</td><td>直接编码型 DFA 的类型定义、实现，对 lexer.cpp 不可见</td></tr><tr><td>lexer/dfa_tbldrv.cpp</td><td>表驱动型　DFA 的类型定义、实现，对 lexer.cpp 不可见</td></tr><tr><td>lexer/lexer_main.cpp</td><td>词法分析的测试主程序，仅测试词法分析自身时使用</td></tr></tbody></table></figure><p>在文件 dfa_tbldrv.cpp 中，对表驱动型 DFA 的状态转换矩阵当作“稀疏矩阵”，并采用了基于三元组的“压缩”存储策略。</p><h3><a name='header-n178' class='md-header-anchor '></a>生成词法测试程序</h3><p>我编写的 lexer_main.cpp 文件，就是词法分析测试的主程序。
编译生成可执行的 <strong>词法分析测试程序</strong> 时，在你的开发工具中，应建立一个 <strong>控制台项目(Win32 Console Application)</strong>。 在编译环境环境中应定义宏 <code>TEST_LEXER</code>，否则词法分析无法测试。</p><p>若你用 Code::Blocks 或 Dev-Cpp 中携带的 GCC 编译时，执行下面的命令：</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 37.1614px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>3</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28.9974px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">g++ -o lexer_test.exe -D TEST_LEXER -I include \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  lexer/lexer.cpp lexer/dfa_tbldrv.cpp lexer/dfa_hardCode.cpp \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  lexer/lexer_main.cpp</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="height: 68px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><blockquote><p>行末尾的反斜杠是续行符（下同），你在执行时，应去掉它，并将它们拼接为一行！</p></blockquote><p><strong>重要提示</strong></p><p>若你的解释器之源代码文件采用 UTF-8 存储，则需要为GCC增加额外的两个 g++ 参数：</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 37.1614px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>2</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28.9974px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-finput-charset=UTF-8</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-fexec-charset=GBK</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="height: 45px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><p>否则输出的汉字是乱码。此时完整的命令是：</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 37.1614px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>4</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28.9974px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">g++ -finput-charset=UTF-8 -fexec-charset=GBK \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  -o lexer_test.exe -D TEST_LEXER -I include \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  lexer/lexer.cpp lexer/dfa_tbldrv.cpp lexer/dfa_hardCode.cpp \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  lexer/lexer_main.cpp</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="height: 90px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><p>编译通过后，接着就可以执行测试程序了：</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 37.1614px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28.9974px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lexer_test.exe  你的函数绘图语言源程序文件路径</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="height: 23px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><h2><a name='header-n191' class='md-header-anchor '></a>3.2 记号的数据类型</h2><p>本程序中定义了一个类 <code>class Token</code> ，这是记号对象的类型。记号对象中除了存储其种类外，还存储了其在输入中的位置、文本等信息，也存储了记号的一些语义信息，比如常数的值、函数调用的入口地址等。</p><p>特别提醒：记号文本的存储采用了“<strong>直接存储</strong>”，而不是《解答》中的“间接”存储。这样就可以将全部 记号 对象存储到 语法树上。</p><h2><a name='header-n194' class='md-header-anchor '></a>3.3 词法错误处理策略</h2><p>我设计的词法分析器在词法分析过程中，可以发现两类输入错误：</p><ul><li>非法字符，该字符不属于 DFA 的字母表，但可能是一个有效的文字字符，如汉字，美元符号 $ 等等。</li><li>无效标识符。因为函数绘图语言不允许用户自定义变量，所有认可的标识符都是固定的，参见文件 lexer.cpp 中的内置、固定的符号表 <code>TokenTab[]</code> 定义。</li></ul><p>词法分析器模块按以下方式来处理错误：</p><ol start='' ><li>当打开文件失败时，仅通过 <code>InitScanner()</code> 的返回值向调用者报告，而错误的显示等处理则交给调用者负责。</li><li>对于词法分析过程中发现的错误，统一由 <code>GetToken()</code> 返回一个种类为 <code>ERRTOKEN</code> 的记号， 示意这是个“词法错误”。而该错误的显示、处理均交由调用者负责。
词法分析测试主程序(lexer_main.cpp)运行时，凡是输出记号类别为 ERRTOKEN 的都是这种错误。</li></ol><h1><a name='header-n208' class='md-header-anchor '></a>4. 语法分析器模块（目录 parser）</h1><h2><a name='header-n209' class='md-header-anchor '></a>4.1 源文件</h2><figure><table><thead><tr><th>文件</th><th>文件内容说明</th></tr></thead><tbody><tr><td>include/parser.hpp</td><td>语法分析器类型定义，以及对外提供的接口声明</td></tr><tr><td>include/ast.hpp</td><td>语法树的类层次定义，类上也提供了必须的语义计算函数</td></tr><tr><td>parser/parser.cpp</td><td>语法分析器的实现</td></tr><tr><td>parser/ast.cpp</td><td>语法树的部分函数的实现，其他的简单函数实现都在 ast.hpp 中</td></tr><tr><td>parser/parser_main.cpp</td><td>语法分析器的测试主程序，仅仅在测试语法分析器自身时使用</td></tr></tbody></table></figure><h3><a name='header-n229' class='md-header-anchor '></a>生成语法测试程序</h3><p>我编写的 parser_main.cpp 文件，就是语法分析测试的主程序。因为语法分析依赖于词法分析模块、错误报告模块、人机界面模块的部分程序，所以生成语法分析测试程序时，需要和这些模块的代码一起编译。具体依赖的其他文件包括：</p><ul><li>errlog/errlog.cpp,  错误报告模块</li><li>ui_main/ui_wrap.cpp,  人机界面模块</li><li>ui_main/ui_console.cpp, 人机界面模块</li></ul><p>编译生成可执行的 <strong>语法分析测试程序</strong> 时，在你的开发工具中，应建立一个 <strong>控制台项目(Win32 Console Application)</strong>。在编译环境环境中应定义宏 <code>TEST_PARSER</code>，否则语法分析无法测试。</p><p>若你用 Code::Blocks 或 Dev-Cpp 中携带的 GCC 编译时，执行下面的命令：</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 37.1614px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>5</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28.9974px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">g++ -o parser_test.exe -D TEST_PARSER -I include \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  lexer/lexer.cpp lexer/dfa_tbldrv.cpp lexer/dfa_hardCode.cpp \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  parser/ast.cpp parser/parser.cpp \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  errlog/errlog.cpp ui_main/ui_wrap.cpp ui_main/ui_console.cpp \</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  parser/parser_main.cpp</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="height: 113px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><p>编译通过后，接着就可以执行测试程序了：</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 37.1614px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>1</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28.9974px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">parser_test.exe  你的函数绘图语言源程序文件路径</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="height: 23px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><h2><a name='header-n243' class='md-header-anchor '></a>4.2 实现模式</h2><p>在《编译原理》课程中提到，语法分析方法有自上而下 和 自下而上 两大类；而自上而下分析方法在具体实现时又有表驱动型的、有直接编码型的。</p><p>这里实现的是<strong>递归下降的语法分析器</strong> —— 这是直接编码型、自上而下的语法分析器。你也可以将其改造为 预测分析器，或者 SLR(1)分析器。</p><p>词法分析和语法分析之间有多种协作方式，为方便起见，我按照【将词法分析作为语法分析的子程序】这种策略来实现，从而使得 语法分析+词法分析 合并为一个阶段。</p><h2><a name='header-n247' class='md-header-anchor '></a>4.3 关于语法树</h2><p>虽然实验仅要求为各类表达式构造语法树，但我的这个实现中，为了将语法分析、语义分析划分为两个明确的工作阶段，这就要求：</p><ul><li>为完整输入（即所有有效语句）创建语法树，</li><li>将所有语句的语法树组织为一个完整的大树。其根是一个“虚结点”，我存放了被分析的文件名。</li></ul><p>语法分析完毕后，若为输入构造的语法树非空，则该树必须由语法分析的调用者（如语义分析器或主控）来销毁!!!</p><p>为便于操纵语法树，我并没有定义表示“语法树”的类，而是按照常见方式，仅定义了语法树结点的相应类型。</p><p>按照面向对象方法的理念，首先对所有可能的语法树结点按其性质进行分类，然后根据这个分类定义了表示语法树（结点）的类层次结构，其中有抽象类，有具体类。具体类才会有实例，该实例就是出现在语法树中的一个个结点对象。</p><p>这个类层次中，位于最高层的类是 <code>class AST</code>（声明在文件 ast.hpp 中），它有三个直接派生类：</p><ul><li><p>AST_expression : 所有<strong>表达式</strong>语法树中各类结点的共同基类，</p><ul><li>有多个子类，每个子类也有自己的子类；</li><li>表达式中每个结点都是该类型之某个具体子类的实例；</li><li>每个具体子类都定义了自己的求值方法。</li></ul></li><li><p>AST_statement : 所有<strong>语句</strong>之树根结点的共同基类，</p><ul><li>有多个子类，每个子类对应一种语句；</li><li>每条语句就是其子类的一个实例；</li><li>其儿子结点都是 一个完整表达式的树根结点。一个语句包括几个表达式，AST_statement 就有几个孩子结点。</li></ul></li><li><p>AST_stmt_list : <strong>全部输入</strong>对应的完整语法树树根的类型，</p><ul><li>其实例记录的是文件名，</li><li>其儿子按顺序是每一条语句的树根结点。</li></ul></li></ul><h2><a name='header-n284' class='md-header-anchor '></a>4.4 语法错误处理策略</h2><p>语法分析过程中，可发现语法错误和词法错误。我设计的处理策略是：</p><ul><li>一旦发现语法错误、词法错误，则由语法分析器报告错误信息之后，立即采用“紧急恢复”策略——直接丢弃错误单词，直到遇到一个同步记号后，接着分析。</li><li>若输入中的有效语句为 0 条，则语法分析器给调用者返回空树。</li></ul><p>&nbsp;</p><h1><a name='header-n293' class='md-header-anchor '></a>5. 错误处理模块（目录 errlog）</h1><p>该模块仅提供显示错误、记录错误的服务，供语法分析、语义分析使用。
该模块也提供了记录调试信息的功能。
该模块的接口用 <code>class ErrLog</code> 封装，整个程序中仅存在该类的一个静态实例，且以该类的静态成员存在（也对外隐藏了）。</p><h2><a name='header-n295' class='md-header-anchor '></a>5.1 源文件</h2><ul><li>文件 include/errlog.hpp 定义了错误报告服务类 ErrLog 及接口</li><li>文件 errlog/errlog.cpp 实现了错误报告相关服务</li></ul><p>该模块的实现中，使用了人机界面模块的 ui.hpp 文件, 间接使用了 ui_console.[hc]pp, ui_wrap.cpp 等文件包含的服务实现。</p><h2><a name='header-n302' class='md-header-anchor '></a>5.2 重要提示</h2><p>在《编译原理》课程中提到，错误处理策略应该属于错误处理模块的事情。但我为了实现简单，在错误处理模块中仅仅提供错误信息显示、记录功能。而遇到输入中的各类错误时，具体的处理措施则由各模块自己负责。</p><p>&nbsp;</p><h1><a name='header-n306' class='md-header-anchor '></a>6. 语义分析模块（目录 semantics）</h1><p>该模块通过遍历语法分析器生成的抽象语法树，在遍历过程中完成表达式求值、绘图参数计算、绘图等语义计算任务。</p><p>如果将词法分析+语法分析看作是这个解释器的** 分析前端** 的话，则语义分析器 就是解释器的 <strong>综合后端</strong> ，这两部分和人机界面模块、错误处理模块、主控程序共同构成了完整的解释器程序。</p><h2><a name='header-n309' class='md-header-anchor '></a>6.1 源文件</h2><ul><li>include/semantics.hpp  语义分析器的类型定义 暨 服务接口声明</li><li>semantics/semantics.cpp  语义分析器模块的实现</li></ul><p><strong>重要提示</strong></p><p>从概念上讲，表达式的求值也属于语义分析范畴，但考虑到表达式求值的实现与其语法树（AST_expression 及其子类）的结构相关，所以我将表达式的求值实现在 AST 模块了。而后者却属于语法分析模块的组成部分！</p><p>即：代码结构属于语法分析，但其执行却在语义分析阶段完成。</p><h2><a name='header-n318' class='md-header-anchor '></a>6.2 错误处理策略</h2><p>语法分析阶段能发现的语法错误、词法错误，均由语法分析器负责处理，详见 <a href='#header-n284'>4.4 语法分析器的错误处理策略</a>。</p><p>只要语法分析器构造的语法树非空，语义分析器就会执行。</p><p>但注意：我的这个实现没有检查 任何语义错误（如除数为0、死循环等），所以程序执行时可能会出现异常，或者绘制出来的图形不正确。</p><p>&nbsp;</p><h1><a name='header-n323' class='md-header-anchor '></a>7. 主控+人机界面模块（目录 ui_main）</h1><p>按实验要求，解释器要能绘制图形，但 C/C++ 语言并未提供 图形的绘制操作，所以只能借助于其他代码库（程序）才能完成。</p><p>我的实现仅考虑运行环境是微软的 Windows 系统，且直接利用 Windows API 函数来完成图形绘制、所需的窗口管理等。当然你也可以借用可跨平台的 <a href='https://www.gtk.org/' title='or GTK+'>GTK</a>、<a href='https://baike.baidu.com/item/qt'>QT</a> 、<a href='https://www.wxwidgets.org/'>wxWidgets</a> 等第三方例程库来实现绘图和窗口管理。</p><h2><a name='header-n326' class='md-header-anchor '></a>7.1 源程序</h2><figure><table><thead><tr><th>文件</th><th>文件内容说明</th></tr></thead><tbody><tr><td>include/ui.hpp</td><td>人机界面接口声明，其实现在下面文件中</td></tr><tr><td>ui_console.[HC]pp</td><td>界面种类1：基于控制台的人机界面之类型接口的 声明与实现</td></tr><tr><td>ui_win32.[HC]pp</td><td>界面种类2： 基于 Window 的界面之类型接口的 声明与实现。这个界面没有控制台窗口</td></tr><tr><td>ui_console_win32.[HC]pp</td><td>界面种类3：既有控制台窗口，又有 Window 窗口的混合式人机界面之类型接口的 声明与实现</td></tr><tr><td>ui_wrap.cpp</td><td>对于人机界面之包装类型 UI_wrap 的实现，和 UI 之功能操作的实现</td></tr><tr><td>main_console.cpp</td><td>定义了 main()，是界面种类1 和 3 的主程序</td></tr><tr><td>interpreter.[HC]pp</td><td>解释器 的类型定义于实现，它定义了被 main() 函数调用的第2级主控逻辑</td></tr></tbody></table></figure><p>程序的高层执行逻辑（箭头表示函数调用）：</p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 37.1614px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>8</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -28.9974px; width: 29px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">main() --1-&gt; interpreter::run() 执行解释器</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |----2--&gt; ui*::selectFile()  输入/选择待分析文件</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |----3--&gt; ui*::prepare() &nbsp; &nbsp; 界面准备</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |----4--&gt; interpreter::redoInterpret()  识别+解释执行</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |--4.1---&gt; 初始化 词法分析器、语法分析器、语义分析器 对象</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |--4.2---&gt; 执行语法分析（含词法分析），得到完整输入的抽象语法树</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 19px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |--4.3---&gt; 让语义分析器遍历语法树，完成语义分析</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -28.9974px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 19px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  \----5-&gt; ui*::run()  窗口式界面维持其状态，直到关闭</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="height: 180px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 28px;"></div></div></div></div></pre><p>&nbsp;</p><blockquote><p>我先实现了界面种类1--只有控制台的交互界面，这种界面只能输出文本信息，不能绘制图形；</p></blockquote><blockquote><p>接着实现了界面种类2--只有一个 Window 的界面，这种界面可绘图，要显示、报告的错误信息均以 弹出式对话框 方式显示；</p></blockquote><blockquote><p>最后将上述两种界面进行了综合，实现了混合式界面3，这种界面在控制台窗口中显示文本，在另一个 window 窗口中绘制图形。</p></blockquote><h2><a name='header-n362' class='md-header-anchor '></a>7.2 编译/生成解释器</h2><p>完整的解释器包括的源代码文件有：</p><ul><li>词法分析器源程序，但不包括词法分析测试程序 lexer_main.cpp</li><li>语法分析器源程序，但不包括语法分析测试程序 parser_main.cpp</li><li>语义分析器的源程序</li><li>错误报告的源程序</li><li>人机界面的源程序 及 本章的主控程序</li></ul><p>你可按两种类型来编译生成解释器：</p><p>(1) 只有 GUI 窗口的可执行程序</p><p>  此时，你必须将除了 lexer_main.cpp，parser_main.cpp，main_console.cpp 之外的全部程序文件一起编译；更重要的是，你应该在 Code::Blocks 或 VC++ 中创建“<strong>Win32 Application</strong>型工程”。这种工程的主控函数不是 <code>main()</code>，而是 <code>WinMain()</code>，该函数已经定义在 ui_win32.cpp 中了。</p><p>(2) 有控制台窗口（有/无 GUI 窗口）的可执行程序</p><p>  此时，你必须将除了 lexer_main.cpp，parser_main.cpp 之外的全部程序文件一起编译；更重要的是，你应该在 Code::Blocks 或 VC++ 中创建“<strong>Win32 Console Application</strong>型工程”，还必须指定链接所需函数库 <code>gdi32</code> 和 <code>comdlg32</code> 。
  【用 g++ 编译时，必须使用命令行参数 <code>-l gdi32 -l comdlg32</code>】</p><h2><a name='header-n381' class='md-header-anchor '></a>7.3  执行解释器程序</h2><p>参见前文 <a href='#header-n114' title='2.3 可生成的可执行程序'>2.3 可生成的可执行程序</a> 所描述的程序 3 和程序 4.</p><p>&nbsp;</p><h1><a name='header-n384' class='md-header-anchor '></a>FINAL:我要说的其他话</h1><p>感谢我的前辈<strong>刘坚</strong>教授，是她带着我学习“编译原理”、“编译器”以及相关知识；感谢我的前辈<strong>陈平</strong>教授，是他指导我学习“面向对象技术”，也感谢我的前辈【<strong>金益民</strong>】教授，是他们带领、支持我参与多个实际软件项目开发。</p><p>从他们身上我学到的知识 very more very higher ...</p><hr /><p>若你感兴趣的话，我实现的源代码可供你参考借鉴！
虽然我的实战经验比大家丰富，但仍有很多不足之处，请见谅。</p><p>Good good study, day day up :-)</p><hr /><p>WXQ#XDU
2019/10</p></div>
</body>
</html>